
<!-- <p id="angle">Angle: <br>Up: <br>Down:</p> -->
<canvas id="myCanvas" width="600" height="600" style="display: block; margin: 0 auto;"></canvas>
<script>
angle = 0;
up = 0;
down = 0;
// let stimSrc = stims.shift();
$(document).ready(function(){

    /** This is high-level function.
         * It must react to delta being more/less than zero.
         */
    function handle(delta) {
        var ratio = 2;  // scroll to angle ratio
        var max = 20;
        var min = -20;

        if (delta < 0 && angle < max) {
            angle+= 0.5/ratio;
            up+= 0.5/ratio;
            $("#angle").html( "Angle: " + angle + "<br>Up: " + up + "<br>Down: " + down ); // assuming scroll 2 lines at a time
        }
        else if (delta > 0 && angle > min) {
            angle-= 0.5/ratio
            down+= 0.5/ratio;
            $("#angle").html( "Angle: " + angle + '<br>Up: ' + up + "<br>Down: " + down );
        }
    }

    /** Event handler for mouse wheel event.
     */
    function wheel(event){
            var delta = 0;
            if (!event) /* For IE. */
                    event = window.event;
            if (event.wheelDelta) { /* IE/Opera. */
                    delta = event.wheelDelta/120;
            } else if (event.detail) { /** Mozilla case. */
                    /** In Mozilla, sign of delta is different than in IE.
                     * Also, delta is multiple of 3.
                     */
                    delta = -event.detail/3;
            }
            /** If delta is nonzero, handle it.
             * Basically, delta is now positive if wheel was scrolled up,
             * and negative, if wheel was scrolled down.
             */
            if (delta)
                    handle(delta);
            /** Prevent default actions caused by mouse wheel.
             * That might be ugly, but we handle scrolls somehow
             * anyway, so don't bother here..
             */
            if (event.preventDefault)
                    event.preventDefault();
        event.returnValue = false;
    }

    /** Initialization code.
     * If you use your own event management code, change it as required.
     */
    if (window.addEventListener)
            /** DOMMouseScroll is for mozilla. */
            window.addEventListener("DOMMouseScroll", wheel, false);
    /** IE/Opera. */
    window.onmousewheel = document.onmousewheel = wheel;

});
</script>


<script>
// let sPos = standardStimPos.shift();
// let aPos = adjustingStimPos.shift();
// let respMapping = respMappings.shift();
var img = new Image();
img.src = "img/gabor.png";
var images = [img, stim];
var imageCount = images.length;
var imagesLoaded = 0;

for(var i=0; i<imageCount; i++){
    images[i].onload = function(){
        imagesLoaded++;
        if(imagesLoaded == imageCount){
            allLoaded();
        }
    }
}
function allLoaded() {
    console.log("all loaded");
    console.log(stim.src);
    var canvas = document.getElementById("myCanvas");
    // canvas.width = window.innerWidth;
    // canvas.height = window.innerHeight;
    var w = 50;
    var h = 100;
    function draw() {
        var context = canvas.getContext("2d");
        canvas.width = canvas.width;
        // translate context to center of canvas
        context.translate(canvas.width / 2, canvas.height / 2);
        context.save();
        context.translate(aPos[0],-aPos[1]);
        if (respMapping == "upLeft")
            context.rotate(angle*Math.PI/180);
        else if (respMapping == "upRight")
            context.rotate(-angle*Math.PI/180);
        context.drawImage(img, w/-2, h/-2, w, h);
        context.restore();

        context.save();
        context.translate(sPos[0],-sPos[1]);
        context.drawImage(stim, stim.width/-2, stim.height/-2, stim.width, stim.height);
        context.restore();

        window.requestAnimationFrame(draw);
    }
    draw();
}
</script>